name: Streamtape to HF Loader

on:
  workflow_dispatch:
    inputs:
      # These match your JS payload keys exactly
      st_login:
        description: 'Streamtape API Login'
        required: true
      st_key:
        description: 'Streamtape API Key'
        required: true
      streamtape_links:
        description: 'Streamtape Links (one per line)'
        required: true
      hf_repo_id:
        description: 'Target HF Repo (user/repo)'
        required: true
      hf_repo_type:
        description: 'space, model, or dataset'
        default: 'model'
      hf_token:
        description: 'HF Token'
        required: true

jobs:
  download-upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Aria2 and Dependencies
        run: |
          sudo apt-get update && sudo apt-get install -y aria2
          pip install requests tqdm huggingface_hub

      - name: Run Sequential Downloader
        env:
          # Mapping YAML inputs to Python Environment Variables
          ST_LOGIN: ${{ inputs.st_login }}
          ST_KEY: ${{ inputs.st_key }}
          ST_LINKS: ${{ inputs.streamtape_links }}
          HF_REPO_ID: ${{ inputs.hf_repo_id }}
          HF_REPO_TYPE: ${{ inputs.hf_repo_type }}
          HF_TOKEN: ${{ inputs.hf_token }}
        run: |
          # Fetch your latest script and run it
          curl -L "https://raw.githubusercontent.com/Bogyi2024/log/main/dep_download/dstreamtape.py" -o dstreamtape.py
          python dstreamtape.py
